package com.example.controller;

import com.example.security.MLEService;
import com.example.util.ResourceReader;
import jakarta.servlet.http.HttpServletRequest;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api")
public class SecureController {

    private final MLEService mleService;

    public SecureController(MLEService mleService) {
        this.mleService = mleService;
    }

    @GetMapping("/secure")
    public String getEncryptedPayload(HttpServletRequest request) throws Exception {

        // ğŸ“– Load payload from resources
        String payload = ResourceReader.readFile("payload.json");

        // ğŸ” Encrypt using client's certificate public key
        return mleService.encryptPayload(payload, request);
    }
}

# Enable SSL
server.ssl.enabled=true

# Server identity (certificate)
server.ssl.key-store=classpath:server-keystore.p12
server.ssl.key-store-password=changeit
server.ssl.key-store-type=PKCS12

# Truststore (used to validate client certificate)
server.ssl.trust-store=classpath:server-truststore.p12
server.ssl.trust-store-password=changeit
server.ssl.trust-store-type=PKCS12

# ğŸ”´ THIS enables mTLS
server.ssl.client-auth=need