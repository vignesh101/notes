package com.client.security;

import com.nimbusds.jose.*;
import com.nimbusds.jose.crypto.RSADecrypter;
import org.springframework.stereotype.Service;
import org.springframework.core.io.ClassPathResource;

import java.security.KeyStore;
import java.security.interfaces.RSAPrivateKey;

@Service
public class MLEDecryptService {

    private final RSAPrivateKey privateKey;

    public MLEDecryptService() throws Exception {

        KeyStore ks = KeyStore.getInstance("PKCS12");
        ks.load(new ClassPathResource("client-keystore.p12").getInputStream(),
                "changeit".toCharArray());

        privateKey = (RSAPrivateKey) ks.getKey("client", "changeit".toCharArray());
    }

    public String decrypt(String jwe) throws Exception {

        JWEObject jweObject = JWEObject.parse(jwe);

        jweObject.decrypt(new RSADecrypter(privateKey));

        return jweObject.getPayload().toString();
    }
}